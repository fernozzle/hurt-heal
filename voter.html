<!doctype html>
<html lang="en">
<head>
	<title>hurt-heal voter</title>
	<meta charset="utf-8" />
	<style>/*body{background:black;color:white}*/</style>
</head>
<body>
<!--
<form action="parsevote.cgi" method="post">
	<label for="v">v:</label>
		<input type="text" id="v" name="v" /><br />
	<input type="submit" value="Send vote" />
</form>
-->

<div id="hurts">
</div>

<div><button id="addhurt">Add hurt</button></div>

<div id="heals">
</div>

<div><button id="addheal">Add heal</button></div>

<img id="chalimg" />
<div><input id="challenge" /></div>
<div><input id="solution" /></div>

<button id="submitbutton">Submit vote</button>

<pre id="resultpre">Result will be displayed here</pre>

<script>
var hurtcount = 0, healcount = 0;
var hurtfields = [], healfields = [];
var hurtcont = document.getElementById ("hurts");
var healcont = document.getElementById ("heals");

document.write = function (text) {};
var script = document.createElement('script');
script.onload = function() {
	var imgSrc = "http://www.google.com/recaptcha/api/image?c=" + RecaptchaState ["challenge"];
	document.getElementById ("chalimg").src = imgSrc;
	document.getElementById ("challenge").value = RecaptchaState ["challenge"];
};
script.src = "http://www.google.com/recaptcha/api/challenge?k=6LfnpMwSAAAAAHtjh-GmvaHUQNexX6CaqWPId8Ks";
document.getElementsByTagName('head')[0].appendChild(script);

document.getElementById ("addhurt").onclick = function () {
	var test = document.createElement ("input");
	hurtfields.push (test);
	hurtcont.appendChild (test);
	hurtcont.appendChild (document.createElement ("br"));
}
document.getElementById ("addheal").onclick = function () {
	var test = document.createElement ("input");
	healfields.push (test);
	healcont.appendChild (test);
	healcont.appendChild (document.createElement ("br"));
}
document.getElementById ("submitbutton").onclick = function () {
	votestring = hurtfields.length + "." + healfields.length + ".";
	for (var i = 0; i < hurtfields.length; i++) {
		votestring += hurtfields[i].value + ".";
	}
	for (var i = 0; i < healfields.length; i++) {
		votestring += healfields[i].value + ".";
	}
	
	votestring += document.getElementById ("challenge").value + ".";
	votestring += document.getElementById ("solution").value + "_";

	var x = new XMLHttpRequest();
	x.open ("POST", "hurt-heal.cgi", false);
	x.send (votestring);
	votestring += "\n" + x.responseText;
	
	var resulttext = document.createTextNode (votestring);
	var resultpre = document.getElementById ("resultpre");
	resultpre.removeChild (resultpre.firstChild);	
	resultpre.appendChild (resulttext);
}

</script>

</body>
</html>
